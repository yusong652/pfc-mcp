{
  "command": "contact apply-group",
  "category": "contact",
  "search_keywords": [
    "apply-group",
    "propagate"
  ],
  "description": "Apply contact group names to contacting pieces or bodies. This command traverses all contacts within the specified range and applies the contact group names to the pieces or bodies at the ends of each contact. By default, group names are applied to pieces (balls, clump pebbles, wall facets). Use the 'body' keyword to apply to bodies (balls, clumps, walls) instead. This is useful for propagating group assignments from contacts to the objects they connect. By default, only mechanical contacts are considered.",
  "syntax": "contact <sprocess> apply-group <keyword> <range>",
  "keywords": [
    {
      "name": "body",
      "syntax": "body",
      "description": "Apply contact group names to bodies (clumps, walls) instead of pieces (pebbles, facets)",
      "default": "false (applies to pieces by default)"
    },
    {
      "name": "slot",
      "syntax": "slot <s>",
      "description": "Apply contact group names from slot s. By default, uses contact slot 'Default'",
      "parameters": [
        {
          "name": "s",
          "type": "string",
          "description": "Source contact slot name"
        }
      ]
    },
    {
      "name": "group",
      "syntax": "group <s>",
      "description": "Restrict application to only the contact group name s",
      "parameters": [
        {
          "name": "s",
          "type": "string",
          "description": "Specific group name to apply"
        }
      ],
      "notes": "Without this keyword, all group names from contacts are applied"
    },
    {
      "name": "piece-slot",
      "syntax": "piece-slot <s>",
      "description": "Apply contact group names to piece slot s. By default, uses same slot as contact slot",
      "parameters": [
        {
          "name": "s",
          "type": "string",
          "description": "Target piece slot name"
        }
      ]
    },
    {
      "name": "body-slot",
      "syntax": "body-slot <s>",
      "description": "Apply contact group names to body slot s. By default, uses same slot as contact slot",
      "parameters": [
        {
          "name": "s",
          "type": "string",
          "description": "Target body slot name"
        }
      ],
      "notes": "Only relevant when 'body' keyword is used"
    }
  ],
  "examples": [
    {
      "command": "contact apply-group",
      "description": "Apply all contact group names to pieces at contact ends using default slot",
      "use_case": "Propagate contact groups to pieces for subsequent range selection"
    },
    {
      "command": "contact apply-group body",
      "description": "Apply contact group names to bodies instead of pieces",
      "use_case": "When working with clumps, apply groups to clump bodies rather than individual pebbles"
    },
    {
      "command": "contact apply-group range group 'boundary'",
      "description": "Apply group names only from contacts in 'boundary' group",
      "use_case": "Selective propagation from specific contact subset"
    },
    {
      "command": "contact apply-group group 'specimen' range contact",
      "description": "Apply only the 'specimen' group name from contacts to pieces",
      "use_case": "Propagate specific group name while ignoring others"
    },
    {
      "command": "contact apply-group slot 'interface' piece-slot 'region'",
      "description": "Apply groups from contact slot 'interface' to piece slot 'region'",
      "use_case": "Map contact groups to different piece slot for organization"
    },
    {
      "command": "contact apply-group body body-slot 'assembly'",
      "description": "Apply contact groups to body slot 'assembly'",
      "use_case": "Organize bodies based on contact group assignments"
    },
    {
      "command": "contact apply-group range contact type 'ball-ball'",
      "description": "Apply group names only from ball-ball contacts",
      "use_case": "Selective propagation based on contact type"
    }
  ],
  "python_sdk_alternative": {
    "available": false,
    "workaround": "itasca.command('contact apply-group ...') - Python SDK does not provide direct apply-group functionality. Manual implementation requires:\n1. Iterate through contacts\n2. Get contact group name: contact.group(slot)\n3. Get contact ends: contact.end1(), contact.end2()\n4. Apply group to pieces/bodies: piece.set_group() or body.set_group()\n\nExample:\nfor c in it.contact.list():\n    group_name = c.group('Default')\n    if group_name:\n        c.end1().set_group(group_name, 'Default')\n        c.end2().set_group(group_name, 'Default')"
  },
  "related_commands": [
    "contact group",
    "ball group",
    "wall group",
    "clump group",
    "contact list"
  ],
  "notes": [
    "This command APPLIES (copies) contact group names TO pieces/bodies, not the reverse",
    "Default behavior: applies to pieces (balls, pebbles, facets)",
    "Use 'body' keyword to apply to bodies (balls, clumps, walls)",
    "If piece/body has multiple contacts with different group names, LAST contact group name wins",
    "Default slot behavior: contact slot → same piece/body slot",
    "Can map between different slots using piece-slot or body-slot keywords",
    "More efficient than Python iteration for bulk group propagation",
    "Useful for organizing model based on contact topology"
  ],
  "group_propagation_concept": {
    "description": "Apply-group propagates group assignments from contacts to the objects they connect",
    "workflow": [
      "1. Contacts have group names assigned (via 'contact group' command)",
      "2. Execute 'contact apply-group' to propagate groups",
      "3. Group names are copied from contacts to pieces/bodies at contact ends",
      "4. Pieces/bodies can now be selected using these group names"
    ],
    "direction": "Contact → Piece/Body (one-way propagation)",
    "typical_use": "Identify pieces/bodies based on contact topology or contact properties"
  },
  "piece_vs_body": {
    "pieces": {
      "description": "Fundamental geometric entities",
      "types": [
        "balls",
        "clump pebbles",
        "wall facets"
      ],
      "default_behavior": "Groups applied to pieces by default",
      "command": "contact apply-group (no 'body' keyword)",
      "when_to_use": "Standard simulations, when working with individual geometric entities"
    },
    "bodies": {
      "description": "Collections or parent entities",
      "types": [
        "balls (standalone)",
        "clumps (collection of pebbles)",
        "walls (collection of facets)"
      ],
      "command": "contact apply-group body",
      "when_to_use": "When working with clumps and need to assign groups to entire clump rather than individual pebbles"
    },
    "key_difference": {
      "piece": "Individual pebble in a clump gets the group",
      "body": "Entire clump (parent) gets the group"
    },
    "example": {
      "scenario": "A clump with 10 pebbles has contacts with group 'specimen'",
      "piece_mode": "Each pebble with contacts gets group 'specimen' individually",
      "body_mode": "The clump itself gets group 'specimen'"
    }
  },
  "slot_mapping": {
    "description": "How slots map from contacts to pieces/bodies",
    "default_behavior": {
      "source": "Contact slot 'Default'",
      "target_piece": "Piece slot 'Default' (same as source)",
      "target_body": "Body slot 'Default' (same as source)"
    },
    "custom_mapping": {
      "use_slot": "Change source contact slot: slot 'interface'",
      "use_piece_slot": "Change target piece slot: piece-slot 'region'",
      "use_body_slot": "Change target body slot: body-slot 'assembly'",
      "example": "contact apply-group slot 'interface' piece-slot 'region'"
    },
    "typical_workflow": [
      "1. Assign contact groups to specific slot: contact group 'interface' 'boundary' range ...",
      "2. Apply to pieces in different slot: contact apply-group slot 'interface' piece-slot 'region'",
      "3. Pieces in 'region' slot now have group names from 'interface' contact slot"
    ]
  },
  "multiple_contacts_behavior": {
    "description": "What happens when a piece/body has multiple contacts with different group names",
    "rule": "LAST contact group name is applied (overwrites previous)",
    "note": "The order of contact traversal determines which group name 'wins'",
    "implications": [
      "Non-deterministic if contact order is not controlled",
      "May result in unexpected group assignments",
      "Use 'group' keyword to restrict to single group name"
    ],
    "mitigation": "Use 'group' keyword to apply only specific group name: contact apply-group group 'specimen'"
  },
  "common_use_cases": [
    {
      "use_case": "Identify pieces by contact topology",
      "workflow": [
        "1. Assign groups to contacts based on criteria: contact group 'Default' 'boundary' range contact type 'ball-facet'",
        "2. Propagate to pieces: contact apply-group",
        "3. All pieces with ball-facet contacts now in 'boundary' group",
        "4. Can now select these pieces: ball delete range group 'boundary'"
      ],
      "notes": "Useful for selecting pieces based on what they're in contact with"
    },
    {
      "use_case": "Organize model by contact model type",
      "workflow": [
        "1. Assign groups to contacts by model: contact group 'Default' 'bonded' range model linearpbond",
        "2. Propagate to pieces: contact apply-group",
        "3. Pieces with bonded contacts now in 'bonded' group",
        "4. Can analyze bonded region separately"
      ]
    },
    {
      "use_case": "Transfer boundary conditions via contacts",
      "workflow": [
        "1. Create boundary contacts with specific group: contact group 'Default' 'fixed' range ...",
        "2. Apply to bodies: contact apply-group body",
        "3. Bodies at boundary now have 'fixed' group",
        "4. Apply boundary conditions: ball fix velocity range group 'fixed'"
      ]
    },
    {
      "use_case": "Clump assembly identification",
      "workflow": [
        "1. Contacts within assembly have 'assembly-A' group",
        "2. Propagate to clumps: contact apply-group body",
        "3. All clumps in assembly now tagged with 'assembly-A'",
        "4. Can manipulate entire assembly: clump delete range group 'assembly-A'"
      ],
      "notes": "Important to use 'body' keyword to tag entire clumps"
    },
    {
      "use_case": "Map contact groups to different piece slot",
      "workflow": [
        "1. Contact groups in 'interface' slot indicate interface type",
        "2. Map to 'region' piece slot: contact apply-group slot 'interface' piece-slot 'region'",
        "3. Pieces now have region classification based on interface contacts",
        "4. Keep interface and region classifications separate in different slots"
      ]
    }
  ],
  "typical_workflow": [
    "1. Assign groups to contacts using 'contact group' command",
    "2. Decide whether to apply to pieces or bodies",
    "3. Decide which slots to use (source and target)",
    "4. Execute 'contact apply-group' with appropriate keywords",
    "5. Groups are now propagated from contacts to pieces/bodies",
    "6. Use propagated groups for range selection or analysis"
  ],
  "apply_group_vs_contact_group": {
    "contact_group": {
      "function": "Assign group names TO contacts",
      "syntax": "contact group <slot> <name> <range>",
      "direction": "User → Contact (assigns groups)",
      "example": "contact group 'Default' 'boundary' range contact type 'ball-facet'",
      "result": "Contacts have group names"
    },
    "contact_apply_group": {
      "function": "Propagate group names FROM contacts TO pieces/bodies",
      "syntax": "contact apply-group <keywords> <range>",
      "direction": "Contact → Piece/Body (propagates groups)",
      "example": "contact apply-group",
      "result": "Pieces/bodies have group names copied from contacts"
    },
    "typical_sequence": [
      "1. Assign groups to contacts: contact group 'Default' 'specimen' range ...",
      "2. Propagate to pieces: contact apply-group",
      "3. Pieces now have 'specimen' group from contacts"
    ]
  },
  "group_keyword_usage": {
    "without_group_keyword": {
      "behavior": "All contact group names are applied to pieces/bodies",
      "example": "contact apply-group",
      "result": "All groups from all contacts propagated"
    },
    "with_group_keyword": {
      "behavior": "Only specified contact group name is applied",
      "example": "contact apply-group group 'specimen'",
      "result": "Only 'specimen' group propagated, others ignored",
      "benefit": "Selective propagation, avoids overwriting with unwanted groups"
    },
    "typical_use": "Use 'group' keyword when contacts have multiple group names but you only want to propagate specific one"
  },
  "range_specifications": {
    "description": "Range limits which contacts are processed for group propagation",
    "common_ranges": {
      "contact": "All contacts (default if omitted)",
      "group <name>": "Contacts in specified group",
      "type <type>": "Contacts of specific type (ball-ball, ball-facet, etc.)",
      "model <model>": "Contacts with specific contact model",
      "range ball group <name>": "Contacts involving balls in specific group"
    },
    "examples": [
      "contact apply-group range group 'interface'",
      "contact apply-group range contact type 'ball-ball'",
      "contact apply-group range model linearpbond"
    ],
    "note": "Range restricts which CONTACTS are processed, not which pieces/bodies receive groups"
  },
  "performance_considerations": {
    "command_interface": "Fast - bulk group propagation in C++ core",
    "python_manual": "Slow - requires iteration over contacts and manual group assignment",
    "recommendation": "Use command interface for group propagation",
    "complexity": "O(number of contacts × contacts per piece/body)",
    "note": "Command is efficient even for large contact sets"
  },
  "warnings": [
    {
      "type": "last_wins",
      "message": "If piece/body has multiple contacts with different group names, the last contact group name overwrites previous ones",
      "severity": "MEDIUM",
      "mitigation": "Use 'group' keyword to restrict to single group name, or design contact groups to avoid conflicts"
    },
    {
      "type": "one_way_propagation",
      "message": "This command propagates FROM contacts TO pieces/bodies, not the reverse",
      "severity": "LOW",
      "mitigation": "If you want to propagate FROM pieces TO contacts, use 'contact group' with range specifications based on piece groups"
    },
    {
      "type": "default_to_pieces",
      "message": "Without 'body' keyword, groups are applied to pieces (pebbles/facets), not parent bodies (clumps/walls)",
      "severity": "LOW",
      "mitigation": "Use 'body' keyword when working with clumps: contact apply-group body"
    },
    {
      "type": "slot_confusion",
      "message": "Default behavior uses same slot name for contact and piece/body - may cause confusion with multiple slots",
      "severity": "LOW",
      "mitigation": "Be explicit with slot keywords when working with multiple group slots"
    }
  ],
  "troubleshooting": [
    {
      "issue": "Groups not being applied to pieces",
      "solutions": [
        "Check if contacts have groups assigned: use 'contact list' or Python to verify",
        "Verify range specification targets correct contacts",
        "Ensure contacts exist: use 'model clean' to detect contacts if needed",
        "Check if using wrong slot: specify 'slot' keyword explicitly"
      ]
    },
    {
      "issue": "Groups applied to wrong entities (pebbles instead of clumps)",
      "solutions": [
        "Use 'body' keyword to apply to bodies: contact apply-group body",
        "Without 'body', groups go to pieces (pebbles/facets)",
        "For clumps, always use 'body' keyword"
      ]
    },
    {
      "issue": "Unexpected group assignments (wrong group name)",
      "solutions": [
        "Check if piece/body has multiple contacts with different groups",
        "Last contact group name wins - may be non-deterministic",
        "Use 'group' keyword to restrict to specific group: contact apply-group group 'specimen'",
        "Review contact group assignments before applying"
      ]
    },
    {
      "issue": "Groups not in expected slot",
      "solutions": [
        "Check source slot: use 'slot' keyword to specify contact slot",
        "Check target slot: use 'piece-slot' or 'body-slot' keywords",
        "Default behavior: same slot name for contact and target",
        "Example: contact apply-group slot 'interface' piece-slot 'region'"
      ]
    },
    {
      "issue": "Only some pieces got groups",
      "solutions": [
        "Only pieces/bodies at ends of contacts in range receive groups",
        "Pieces without contacts won't receive groups",
        "Check range specification - may be filtering contacts",
        "Verify all intended contacts are included in range"
      ]
    }
  ],
  "advanced_usage": {
    "multiple_slot_organization": {
      "description": "Use different slots for different classification schemes",
      "example": [
        "# Contact interface types in 'interface' slot",
        "contact group 'interface' 'specimen-platen' range ...",
        "contact group 'interface' 'specimen-specimen' range ...",
        "",
        "# Propagate to piece 'region' slot",
        "contact apply-group slot 'interface' piece-slot 'region'",
        "",
        "# Now pieces have region classification in 'region' slot",
        "# Contact interface classification preserved in 'interface' slot"
      ],
      "benefit": "Organize model with multiple independent classification schemes"
    },
    "selective_propagation": {
      "description": "Propagate only specific groups while preserving others",
      "example": [
        "# Propagate only 'boundary' group",
        "contact apply-group group 'boundary'",
        "",
        "# Other contact groups are not propagated",
        "# Existing piece groups in other names preserved"
      ]
    },
    "contact_topology_based_selection": {
      "description": "Select pieces based on contact connectivity",
      "example": [
        "# Mark contacts connected to fixed wall as 'near-wall'",
        "contact group 'Default' 'near-wall' range wall group 'fixed'",
        "",
        "# Propagate to balls",
        "contact apply-group",
        "",
        "# Now balls near wall have 'near-wall' group",
        "# Can apply special treatment: ball property density 3000 range group 'near-wall'"
      ]
    }
  },
  "process_specification": {
    "description": "Optional process name for multi-process simulations",
    "mechanical": {
      "description": "Default mechanical contacts (force transmission)",
      "syntax": "contact apply-group ... (no process specified) or contact mechanical apply-group ..."
    },
    "thermal": {
      "description": "Thermal contacts for heat transfer",
      "syntax": "contact thermal apply-group ...",
      "use_case": "Propagate thermal contact groups to pieces/bodies"
    },
    "note": "Most simulations use mechanical contacts only"
  }
}
