{
  "command": "contact cmat proximity",
  "category": "contact",
  "search_keywords": [
    "cmat",
    "proximity",
    "gap"
  ],
  "description": "Set the contact detection distance for the CMAT (Contact Model Assignment Table). This ensures that contacts will be subsequently detected between pieces with a surface gap less than or equal to the specified value. Contacts may also be created between pieces further apart. This command does NOT automatically trigger contact detection - contacts will be detected during subsequent cycles. To force immediate contact detection, use 'model clean' command. By default, only mechanical contacts are considered.",
  "syntax": "contact cmat <sprocess> proximity <fd>",
  "keywords": [
    {
      "name": "mechanical",
      "syntax": "mechanical",
      "description": "Apply to mechanical contacts (default if no process specified)"
    },
    {
      "name": "thermal",
      "syntax": "thermal",
      "description": "Apply to thermal contacts (if thermal process is active)"
    },
    {
      "name": "proximity",
      "syntax": "proximity <fd>",
      "description": "Set contact detection distance to fd",
      "parameters": [
        {
          "name": "fd",
          "type": "float",
          "description": "Detection distance value (in model length units)"
        }
      ]
    }
  ],
  "examples": [
    {
      "command": "contact cmat proximity 0.0",
      "description": "Set contact detection distance to zero - only detect contacts when pieces touch (from official example)",
      "use_case": "Standard contact detection for rigid particles"
    },
    {
      "command": "contact cmat proximity 1e-6",
      "description": "Allow small proximity gap for contact detection",
      "use_case": "Account for numerical precision or slight initial overlaps"
    },
    {
      "command": "contact cmat proximity 0.1",
      "description": "Detect contacts when pieces are within 0.1 length units",
      "use_case": "Pre-detect contacts before actual contact, useful for certain models"
    },
    {
      "command": "contact cmat mechanical proximity 0.0",
      "description": "Explicitly set mechanical contact detection distance",
      "use_case": "When working with multiple contact processes"
    },
    {
      "command": "contact cmat thermal proximity 1e-5",
      "description": "Set thermal contact detection distance (if thermal model is active)",
      "use_case": "Heat transfer simulations with proximity-based thermal contacts"
    }
  ],
  "python_sdk_alternative": {
    "available": false,
    "workaround": "itasca.command('contact cmat proximity <value>') - Python SDK does not provide direct CMAT proximity API, must use command interface"
  },
  "related_commands": [
    "contact cmat add",
    "contact cmat default",
    "contact cmat apply",
    "model clean"
  ],
  "notes": [
    "This command sets the FUTURE contact detection behavior - does not affect existing contacts",
    "Contact detection happens automatically during cycles, but not immediately after this command",
    "Use 'model clean' to force immediate contact detection after changing proximity",
    "fd = 0.0 is the most common value for standard DEM simulations",
    "Positive fd allows contacts to form before actual geometric contact",
    "Negative fd would require overlap before contact formation (rarely used)",
    "Proximity affects performance: larger values → more potential contacts → slower",
    "This is a global CMAT setting, applies to all new contacts created subsequently",
    "Does not modify existing contacts - only affects contact creation logic"
  ],
  "proximity_concept": {
    "definition": "The maximum surface gap distance at which a contact can be created between two pieces",
    "physical_meaning": "When gap between piece surfaces ≤ proximity value, a contact is eligible for creation",
    "typical_values": {
      "0.0": {
        "description": "Standard rigid particle contact",
        "use_case": "Most common - contacts form only when pieces touch",
        "behavior": "Contact created when gap ≤ 0 (i.e., overlap exists)"
      },
      "small_positive": {
        "description": "Small tolerance (e.g., 1e-6 to 1e-4)",
        "use_case": "Account for numerical precision, initial positioning errors",
        "behavior": "Contact created slightly before geometric contact"
      },
      "large_positive": {
        "description": "Significant separation (e.g., 0.1 to 1.0)",
        "use_case": "Long-range interactions, pre-contact detection",
        "behavior": "Contacts can exist with significant gap",
        "warning": "May significantly increase number of contacts and reduce performance"
      },
      "negative": {
        "description": "Require overlap before contact (rarely used)",
        "use_case": "Special models requiring penetration before contact activation",
        "behavior": "Contact only created after overlap exceeds |proximity|"
      }
    }
  },
  "contact_detection_process": {
    "description": "How PFC uses proximity to create contacts during simulation",
    "workflow": [
      "1. User sets proximity: contact cmat proximity <fd>",
      "2. During each cycle, PFC scans for potential contacts",
      "3. For each piece pair, compute surface gap",
      "4. If gap ≤ fd, create contact (if not already exists)",
      "5. New contact is assigned model and properties according to CMAT rules",
      "6. Contact forces are computed starting from next cycle"
    ],
    "performance_impact": {
      "proximity_0": "Minimal overhead - only check overlapping pieces",
      "small_proximity": "Slight overhead - check near-contact pieces",
      "large_proximity": "Significant overhead - many potential contacts to check",
      "recommendation": "Use smallest proximity that meets simulation needs"
    }
  },
  "proximity_vs_model_clean": {
    "contact_cmat_proximity": {
      "function": "Set detection distance for FUTURE contact creation",
      "timing": "Affects subsequent cycles (lazy detection)",
      "scope": "Global CMAT setting",
      "example": "contact cmat proximity 0.0",
      "immediate_effect": "No - waits for next cycle or model clean"
    },
    "model_clean": {
      "function": "Force immediate contact detection with current proximity setting",
      "timing": "Immediate contact scan",
      "scope": "One-time operation",
      "example": "model clean",
      "immediate_effect": "Yes - scans and creates contacts immediately"
    },
    "typical_sequence": [
      "1. Set proximity: contact cmat proximity 0.0",
      "2. Force detection: model clean",
      "3. Now contacts are created according to proximity setting"
    ]
  },
  "common_use_cases": [
    {
      "use_case": "Standard DEM simulation (touching particles)",
      "workflow": [
        "1. Set zero proximity: contact cmat proximity 0.0",
        "2. Position particles",
        "3. Force contact detection: model clean",
        "4. Contacts created at overlapping/touching boundaries"
      ],
      "notes": "Most common case - contacts form only when pieces physically touch"
    },
    {
      "use_case": "Bonded material with initial assembly",
      "workflow": [
        "1. Generate particle positions with small gaps",
        "2. Set small positive proximity: contact cmat proximity 1e-6",
        "3. Detect contacts: model clean",
        "4. Bond contacts: contact method bond gap 1e-6",
        "5. Particles now bonded even with small initial gaps"
      ],
      "notes": "Small proximity allows bonding of nearly-touching particles"
    },
    {
      "use_case": "Long-range interaction models",
      "workflow": [
        "1. Set large proximity: contact cmat proximity 0.5",
        "2. Assign contact model with distance-dependent forces",
        "3. Contacts form and transmit forces even with separation",
        "4. Model interactions at distance (e.g., adhesion, magnetic)"
      ],
      "notes": "Used for models where forces act at distance"
    },
    {
      "use_case": "Troubleshooting missing contacts",
      "workflow": [
        "1. Suspect contacts not forming properly",
        "2. Temporarily increase proximity: contact cmat proximity 1e-5",
        "3. Force detection: model clean",
        "4. Check if contacts now form",
        "5. If yes, original proximity was too small for particle positioning"
      ],
      "notes": "Diagnostic technique to identify contact detection issues"
    }
  ],
  "typical_workflow": [
    "1. Decide on appropriate proximity based on simulation type (usually 0.0)",
    "2. Set proximity before creating particles: contact cmat proximity 0.0",
    "3. Configure other CMAT settings (models, properties)",
    "4. Create and position particles/walls",
    "5. Force contact detection if needed: model clean",
    "6. Contacts are now created according to proximity setting",
    "7. Continue simulation - new contacts detected automatically each cycle"
  ],
  "when_to_use_nonzero_proximity": {
    "positive_proximity_benefits": [
      "Allow contacts to form before actual geometric overlap",
      "Account for particle positioning errors or numerical precision",
      "Enable bonding of nearly-touching particles",
      "Model long-range interactions (adhesion, van der Waals)",
      "Pre-create contacts for predictive simulations"
    ],
    "positive_proximity_costs": [
      "Increased computational cost - more potential contacts to check",
      "More contacts in system - increased memory usage",
      "May create unexpected contacts if value too large",
      "Can affect simulation stability if not used carefully"
    ],
    "when_to_use": [
      "Bonded simulations with imperfect initial geometry",
      "Long-range force models (adhesion, electrostatic)",
      "Thermal simulations (heat transfer across small gaps)",
      "Troubleshooting contact detection issues"
    ],
    "when_not_to_use": [
      "Standard rigid particle DEM (use 0.0)",
      "Large-scale simulations (performance critical)",
      "Models without long-range interactions"
    ]
  },
  "warnings": [
    {
      "type": "performance_impact",
      "message": "Large proximity values significantly increase number of potential contacts, reducing simulation speed",
      "severity": "MEDIUM",
      "mitigation": "Use smallest proximity that meets simulation requirements. Monitor contact count."
    },
    {
      "type": "not_immediate",
      "message": "Setting proximity does NOT immediately create contacts - use 'model clean' to force detection",
      "severity": "LOW",
      "mitigation": "Follow 'contact cmat proximity' with 'model clean' if immediate detection is needed"
    },
    {
      "type": "global_setting",
      "message": "Proximity is a global CMAT setting - affects all new contact creation, cannot be set per-range",
      "severity": "LOW",
      "mitigation": "N/A - by design"
    },
    {
      "type": "no_effect_on_existing",
      "message": "Changing proximity does not affect existing contacts, only new contact creation",
      "severity": "LOW",
      "mitigation": "To redetect contacts with new proximity, delete contacts and use 'model clean'"
    }
  ],
  "troubleshooting": [
    {
      "issue": "Contacts not forming between particles",
      "solutions": [
        "Check if proximity is too small (increase to 1e-6 or 1e-5)",
        "Force contact detection: model clean",
        "Verify particles are actually close enough (check positions)",
        "Check if contact models are assigned via CMAT",
        "Use 'contact list' to see existing contacts"
      ]
    },
    {
      "issue": "Too many contacts being created",
      "solutions": [
        "Reduce proximity value (try 0.0)",
        "Check particle sizes and spacing",
        "Verify proximity setting: contact cmat list",
        "Large proximity creates contacts at distance - may not be desired"
      ]
    },
    {
      "issue": "Simulation is very slow",
      "solutions": [
        "Check if proximity is too large (many contacts being checked)",
        "Reduce proximity to minimum needed",
        "Monitor contact count to diagnose",
        "Large proximity → many potential contacts → slow performance"
      ]
    },
    {
      "issue": "Changed proximity but no effect",
      "solutions": [
        "Proximity only affects NEW contact creation",
        "Force new contact detection: model clean",
        "Existing contacts are not modified by proximity change",
        "To redetect with new proximity, delete contacts first"
      ]
    },
    {
      "issue": "Bonds not forming even with bond method",
      "solutions": [
        "Check if contacts exist first (need contacts before bonding)",
        "Increase proximity slightly to detect near-contacts: contact cmat proximity 1e-6",
        "Use 'model clean' to detect contacts",
        "Use matching gap in bond method: contact method bond gap 1e-6"
      ]
    }
  ],
  "mechanical_vs_thermal_contacts": {
    "mechanical": {
      "description": "Default contact type for force transmission",
      "typical_proximity": "0.0 (rigid contact) or small positive",
      "syntax": "contact cmat mechanical proximity 0.0",
      "use_case": "Standard DEM simulations"
    },
    "thermal": {
      "description": "Thermal contacts for heat transfer",
      "typical_proximity": "Small positive (allow heat transfer across small gaps)",
      "syntax": "contact cmat thermal proximity 1e-5",
      "use_case": "Coupled thermo-mechanical simulations",
      "note": "Only relevant if thermal process is active"
    },
    "independent_settings": "Mechanical and thermal contacts can have different proximity values"
  },
  "interaction_with_other_cmat_commands": {
    "proximity_and_add": {
      "description": "proximity sets detection distance, add defines what model/properties to assign once detected",
      "sequence": [
        "contact cmat proximity 0.0",
        "contact cmat add model linear property kn 1e8 range ..."
      ],
      "relationship": "Complementary - proximity controls detection, add controls assignment"
    },
    "proximity_and_apply": {
      "description": "proximity affects new contacts, apply affects existing contacts",
      "note": "Changing proximity then calling apply does not redetect contacts with new proximity"
    }
  },
  "advanced_usage": {
    "negative_proximity": {
      "description": "Require overlap before contact creation (uncommon)",
      "syntax": "contact cmat proximity -1e-6",
      "behavior": "Contact created only when overlap > 1e-6",
      "use_case": "Special models where contact should activate after certain penetration",
      "warning": "Can cause instability - particles may overlap significantly before contact forms"
    },
    "dynamic_proximity": {
      "description": "Change proximity during simulation for different phases",
      "workflow": [
        "1. Initial assembly: contact cmat proximity 1e-6 (allow small gaps)",
        "2. Bond assembly: contact method bond gap 1e-6",
        "3. Switch to standard: contact cmat proximity 0.0",
        "4. New contacts (e.g., fragments) form only at touch"
      ],
      "benefit": "Different contact detection rules for different simulation phases"
    }
  },
  "performance_notes": {
    "contact_detection_cost": {
      "description": "Cost of contact detection scales with number of potential contact pairs",
      "proximity_impact": "Larger proximity → more pairs to check → slower detection",
      "optimization": "PFC uses spatial hashing to reduce pairs checked, but proximity still affects performance"
    },
    "contact_count": {
      "description": "Total number of contacts in simulation",
      "proximity_impact": "Larger proximity → more simultaneous contacts → more memory, slower force calculation",
      "monitoring": "Use 'contact list count' or check contact count in output"
    },
    "recommendations": [
      "Use proximity 0.0 for standard simulations",
      "Use small positive values (1e-6 to 1e-4) only when needed",
      "Avoid large proximity (>1% of particle radius) unless required by physics",
      "Monitor contact count to diagnose performance issues"
    ]
  }
}
