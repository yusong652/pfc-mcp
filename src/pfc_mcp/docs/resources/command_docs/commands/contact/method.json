{
  "command": "contact method",
  "category": "contact",
  "search_keywords": [
    "method",
    "deformability",
    "bond",
    "modulus"
  ],
  "description": "Execute contact model methods on existing contacts. The specified method, along with its arguments, is invoked for all contacts in the range that have a contact model supporting that method. Methods are model-specific functions that perform specialized operations like activating bonds, setting deformability parameters, or other model-specific behaviors. By default, only mechanical contacts are considered.",
  "syntax": "contact method <method_name> <arg_name> <arg_value> ... <range>",
  "keywords": [
    {
      "name": "mechanical",
      "syntax": "mechanical",
      "description": "Apply method to mechanical contacts (default behavior)"
    },
    {
      "name": "thermal",
      "syntax": "thermal",
      "description": "Apply method to thermal contacts (instead of mechanical)"
    }
  ],
  "available_methods_by_model": {
    "linear": [
      {
        "name": "deformability",
        "description": "Set linear stiffnesses from material properties",
        "arguments": {
          "emod": "Young's modulus",
          "kratio": "Normal to shear stiffness ratio"
        },
        "example": "contact method deformability emod 60e9 kratio 2.5"
      }
    ],
    "linearpbond": [
      {
        "name": "bond",
        "description": "Activate parallel bonds at contacts",
        "arguments": {
          "gap": "Maximum gap for bonding (optional)"
        },
        "example": "contact method bond gap 0.0"
      },
      {
        "name": "deformability",
        "description": "Set linear component stiffnesses from material properties",
        "arguments": {
          "emod": "Young's modulus",
          "kratio": "Normal to shear stiffness ratio"
        },
        "example": "contact method deformability emod 60e9 kratio 2.5"
      },
      {
        "name": "pb_deformability",
        "description": "Set parallel bond stiffnesses from material properties",
        "arguments": {
          "emod": "Young's modulus (parallel bond)",
          "kratio": "Normal to shear stiffness ratio (parallel bond)"
        },
        "example": "contact method pb_deformability emod 60e10 kratio 1.5"
      }
    ],
    "linearcbond": [
      {
        "name": "bond",
        "description": "Activate contact bonds",
        "arguments": {
          "gap": "Maximum gap for bonding (optional)"
        },
        "example": "contact method bond gap 0.0"
      },
      {
        "name": "deformability",
        "description": "Set linear stiffnesses from material properties",
        "arguments": {
          "emod": "Young's modulus",
          "kratio": "Normal to shear stiffness ratio"
        },
        "example": "contact method deformability emod 60e9 kratio 2.5"
      }
    ],
    "rrlinear": [
      {
        "name": "deformability",
        "description": "Set stiffnesses from material properties",
        "arguments": {
          "emod": "Young's modulus",
          "kratio": "Normal to shear stiffness ratio"
        },
        "example": "contact method deformability emod 60e9 kratio 2.5"
      }
    ],
    "arrlinear": [
      {
        "name": "deformability",
        "description": "Set stiffnesses from material properties",
        "arguments": {
          "emod": "Young's modulus",
          "kratio": "Normal to shear stiffness ratio"
        },
        "example": "contact method deformability emod 60e9 kratio 2.5"
      }
    ],
    "smoothjoint": [
      {
        "name": "deformability",
        "description": "Set stiffnesses from material properties",
        "arguments": {
          "emod": "Young's modulus",
          "kratio": "Normal to shear stiffness ratio"
        },
        "example": "contact method deformability emod 60e9 kratio 2.5"
      }
    ],
    "flatjoint": [
      {
        "name": "deformability",
        "description": "Set stiffnesses from material properties",
        "arguments": {
          "emod": "Young's modulus",
          "kratio": "Normal to shear stiffness ratio"
        },
        "example": "contact method deformability emod 60e9 kratio 2.5"
      }
    ],
    "spring_network": [
      {
        "name": "deformability",
        "description": "Set spring network stiffnesses",
        "arguments": {
          "emod": "Young's modulus",
          "kratio": "Normal to shear stiffness ratio"
        },
        "example": "contact method deformability emod 60e9 kratio 2.5"
      }
    ]
  },
  "examples": [
    {
      "command": "contact method bond gap 0.0 pb_deformability emod 60e9 kratio 2.5",
      "description": "Bond contacts with parallel bond model and set parallel bond stiffnesses from material properties (from SRM specimen example)",
      "model": "linearpbond"
    },
    {
      "command": "contact method bond range contact active",
      "description": "Activate bonds on all active contacts (from rigid block tunnel excavation)",
      "model": "linearpbond or linearcbond"
    },
    {
      "command": "contact method pb_deformability emod 60e10 kratio 1.0",
      "description": "Set parallel bond stiffnesses based on elastic modulus and stiffness ratio",
      "model": "linearpbond"
    },
    {
      "command": "contact method deformability emod 60e9 kratio 2.5",
      "description": "Set linear component stiffnesses from material properties for all contacts",
      "model": "linear, linearpbond, linearcbond, etc."
    },
    {
      "command": "contact method bond gap 1e-6 range group 'specimen'",
      "description": "Bond contacts in 'specimen' group allowing small initial gap",
      "model": "linearpbond or linearcbond"
    },
    {
      "command": "contact method deformability emod 50e9 kratio 1.5 range contact type 'ball-ball'",
      "description": "Set stiffnesses for ball-ball contacts only",
      "model": "any model with deformability method"
    }
  ],
  "python_sdk_alternative": {
    "available": true,
    "methods": [
      {
        "signature": "contact.method(method_name, args=None)",
        "description": "Execute a contact model method on a contact object",
        "parameters": {
          "method_name": "String identifying method (e.g., 'bond', 'deformability')",
          "args": "Dictionary with string keys for method arguments (optional)"
        },
        "example": "for c in it.contact.list(): c.method('bond', {'gap': 0.0})"
      }
    ],
    "notes": [
      "Python SDK requires iteration over contacts - cannot execute method on all contacts in one call",
      "Method arguments must be passed as a dictionary (not name-value pairs)",
      "Command interface is more efficient for bulk method execution",
      "Use range specification in command interface to avoid Python iteration"
    ],
    "command_vs_python": {
      "command": "contact method bond gap 0.0",
      "python": "for c in it.contact.list(): c.method('bond', {'gap': 0.0})"
    }
  },
  "related_commands": [
    "contact model",
    "contact property",
    "contact cmat add",
    "contact cmat default"
  ],
  "notes": [
    "Methods are model-specific - only contacts whose model supports the method are affected",
    "Contacts whose model doesn't support the method are silently ignored",
    "Multiple methods can be chained in a single command by listing multiple method-argument pairs",
    "Method execution happens immediately",
    "More efficient than Python iteration for bulk method invocation",
    "Methods often modify internal contact state beyond simple property updates",
    "Common use: activating bonds after setting bond properties",
    "The 'deformability' method calculates stiffnesses from material properties (emod, kratio)",
    "The 'bond' method activates bonds that were previously inactive"
  ],
  "method_vs_property": {
    "contact_method": {
      "function": "Execute model-specific operations",
      "scope": "Invokes internal model logic",
      "examples": [
        "Activate bonds (change internal state)",
        "Calculate stiffnesses from material properties",
        "Initialize model-specific features"
      ],
      "data_modification": "Can modify multiple properties and internal states",
      "typical_use": "One-time initialization or state changes"
    },
    "contact_property": {
      "function": "Directly set property values",
      "scope": "Modify property values",
      "examples": [
        "Set kn=1e8 (direct assignment)",
        "Set pb_ten=2e5 (direct assignment)",
        "Set fric=0.5 (direct assignment)"
      ],
      "data_modification": "Only modifies specified properties",
      "typical_use": "Adjust parameters during simulation"
    },
    "when_to_use_method": "When you need to perform complex operations (bonding, deformability calculation) that involve multiple property updates or state changes",
    "when_to_use_property": "When you need to directly set specific property values"
  },
  "common_use_cases": [
    {
      "use_case": "Bond assembly after positioning",
      "workflow": [
        "1. Create and position balls/pebbles to form specimen",
        "2. Assign bonded model: contact cmat add model linearpbond ...",
        "3. Set bond properties: contact property pb_kn 1e9 pb_ks 5e8 pb_ten 1e7 pb_coh 5e6",
        "4. Activate bonds: contact method bond gap 0.0",
        "5. Bonds are now active and resist separation/shear"
      ],
      "notes": "Without calling the 'bond' method, bonds remain inactive even if model and properties are set"
    },
    {
      "use_case": "Set stiffnesses from material properties",
      "workflow": [
        "1. Know material properties (E=60 GPa, Poisson=0.25, kratio=2.5)",
        "2. Use deformability method: contact method deformability emod 60e9 kratio 2.5",
        "3. Contact stiffnesses (kn, ks) are calculated automatically",
        "4. Consistent with piece properties if inheritance is enabled"
      ],
      "notes": "Deformability method is more convenient than manually calculating and setting kn/ks"
    },
    {
      "use_case": "Different stiffnesses for linear and parallel bond components",
      "workflow": [
        "1. Model is linearpbond",
        "2. Set linear stiffnesses: contact method deformability emod 60e9 kratio 2.5",
        "3. Set parallel bond stiffnesses: contact method pb_deformability emod 60e10 kratio 1.5",
        "4. Linear and bond components can have different mechanical properties"
      ]
    },
    {
      "use_case": "Selective bonding by group",
      "workflow": [
        "1. Specimen has multiple groups (e.g., 'specimen', 'platen')",
        "2. Bond only specimen: contact method bond gap 0.0 range group 'specimen'",
        "3. Platen contacts remain unbonded (slip allowed)"
      ]
    }
  ],
  "typical_workflow": [
    "1. Ensure contacts exist and have appropriate contact models assigned",
    "2. Set any required properties first (e.g., bond strengths before bonding)",
    "3. Execute method with appropriate arguments and range",
    "4. Method executes immediately on all matching contacts",
    "5. Verify results (optional): check bonded state, stiffness values, etc.",
    "6. Continue simulation with modified contact behavior"
  ],
  "deformability_method": {
    "purpose": "Calculate contact stiffnesses from material properties (Young's modulus and stiffness ratio)",
    "arguments": {
      "emod": {
        "description": "Young's modulus (elastic modulus) of material",
        "units": "Pa (Pascals)",
        "typical_range": "1e9 to 1e11 (GPa range)"
      },
      "kratio": {
        "description": "Ratio of normal stiffness to shear stiffness (kn/ks)",
        "units": "dimensionless",
        "typical_range": "1.0 to 3.0",
        "notes": "Related to Poisson's ratio: kratio ≈ (2-2ν)/(1-2ν) for ν in [0, 0.5]"
      }
    },
    "calculation": "Contact stiffnesses (kn, ks) are computed from emod, kratio, and contact geometry (radii). Exact formula depends on contact model.",
    "benefits": [
      "Automatic stiffness calculation based on material properties",
      "Ensures consistency between contact and piece properties",
      "Easier calibration - work with familiar material properties",
      "Less error-prone than manual kn/ks calculation"
    ],
    "models_supporting": [
      "linear",
      "linearpbond (both deformability and pb_deformability)",
      "linearcbond",
      "rrlinear",
      "arrlinear",
      "smoothjoint",
      "flatjoint"
    ]
  },
  "bond_method": {
    "purpose": "Activate bonds at contacts for bonded contact models (linearpbond, linearcbond)",
    "arguments": {
      "gap": {
        "description": "Maximum gap distance for bonding",
        "units": "length units (same as model)",
        "default": "0.0",
        "notes": "Contacts with gap > specified value will not be bonded. Typically 0.0 for zero initial gap."
      }
    },
    "preconditions": [
      "Contact model must support bonding (linearpbond or linearcbond)",
      "Bond properties should be set before calling bond method (pb_kn, pb_ks, pb_ten, pb_coh for linearpbond; cb_* for linearcbond)"
    ],
    "effects": [
      "Sets bond state to active",
      "Initializes bond geometry (area, radii for parallel bonds)",
      "From this point, contacts resist separation and shearing according to bond strength"
    ],
    "models_supporting": [
      "linearpbond (parallel bonds)",
      "linearcbond (contact bonds)"
    ],
    "typical_sequence": [
      "1. Assign model: contact model linearpbond",
      "2. Set bond properties: contact property pb_kn 1e9 pb_ks 5e8 pb_ten 1e7 pb_coh 5e6",
      "3. Activate bonds: contact method bond gap 0.0",
      "4. Check bonded state: contact.bonded() returns True"
    ]
  },
  "range_specifications": {
    "description": "Range limits which contacts the method is applied to",
    "common_ranges": {
      "contact": "All contacts (default if omitted)",
      "contact active": "Only active contacts",
      "group <name>": "Contacts in specified group",
      "type <type>": "Contacts of specific type (ball-ball, ball-facet, etc.)",
      "model <model>": "Contacts with specific contact model"
    },
    "examples": [
      "contact method bond gap 0.0 range contact active",
      "contact method deformability emod 60e9 kratio 2.5 range group 'specimen'",
      "contact method pb_deformability emod 60e10 kratio 1.5 range contact type 'ball-ball'"
    ]
  },
  "performance_considerations": {
    "command_interface": "Very fast - bulk method execution in C++ core",
    "python_iteration": "Slower - Python loop overhead + method call for each contact",
    "recommendation": "Use command interface for bulk method execution, Python for selective/conditional execution",
    "example_comparison": [
      {
        "approach": "Command",
        "code": "itasca.command('contact method bond gap 0.0')",
        "speed": "Fast - single bulk operation"
      },
      {
        "approach": "Python loop",
        "code": "for c in it.contact.list():\\n    c.method('bond', {'gap': 0.0})",
        "speed": "Slower - iteration overhead + per-contact method call"
      }
    ]
  },
  "warnings": [
    {
      "type": "method_availability",
      "message": "Only contacts whose model supports the method will be affected - others are silently ignored",
      "example": "Calling 'bond' method on contacts with linear model has no effect"
    },
    {
      "type": "argument_requirements",
      "message": "Method arguments are method-specific and model-specific - incorrect arguments may be ignored or cause errors",
      "mitigation": "Refer to contact model documentation for available methods and their arguments"
    },
    {
      "type": "immediate_execution",
      "message": "Method executes immediately - may cause sudden state changes (e.g., force jumps when activating bonds)",
      "mitigation": "Execute methods at appropriate times (e.g., bond at equilibrium, before applying loads)"
    },
    {
      "type": "prerequisite_properties",
      "message": "Some methods require properties to be set first (e.g., bond method requires bond strength properties)",
      "example": "If pb_ten and pb_coh are not set, bonds may break immediately after activation"
    }
  ],
  "troubleshooting": [
    {
      "issue": "Method has no effect",
      "solutions": [
        "Check if contact model supports the method (e.g., linear model doesn't support 'bond')",
        "Verify range specification targets correct contacts",
        "Use 'contact cmat list' or Python to check contact models",
        "Consult contact model documentation for available methods"
      ]
    },
    {
      "issue": "Bonds break immediately after activation",
      "solutions": [
        "Bond strengths (pb_ten, pb_coh) may be too low",
        "Initial forces may exceed bond strength",
        "Set higher bond strengths: contact property pb_ten <higher_value> pb_coh <higher_value>",
        "Activate bonds at equilibrium (after initial settling)"
      ]
    },
    {
      "issue": "Deformability method gives unexpected stiffnesses",
      "solutions": [
        "Check emod and kratio values are appropriate for your model scale",
        "Verify contact model supports deformability method",
        "Check if stiffness inheritance is enabled (may override method-set values)",
        "Use 'contact property' to directly set kn/ks if needed"
      ]
    },
    {
      "issue": "Want to call multiple methods on same contacts",
      "solutions": [
        "Chain methods in single command: contact method deformability emod 60e9 kratio 2.5 pb_deformability emod 60e10 kratio 1.5",
        "Or call methods sequentially",
        "Methods execute in the order specified"
      ]
    },
    {
      "issue": "Method arguments not recognized",
      "solutions": [
        "Verify method name is correct (case-sensitive)",
        "Check argument names match method documentation",
        "Ensure arguments are provided as name-value pairs",
        "For Python: arguments must be in dictionary format"
      ]
    }
  ],
  "model_properties_reference": {
    "path": "model-properties/index.json",
    "description": "For detailed property information for each contact model (which properties to set before calling methods), see the model-properties reference documentation",
    "note": "Bond methods typically require bond strength properties to be set first"
  },
  "advanced_usage": {
    "chaining_methods": {
      "description": "Multiple methods can be executed in a single command",
      "syntax": "contact method <method1> <args1> <method2> <args2> ... <range>",
      "example": "contact method deformability emod 60e9 kratio 2.5 pb_deformability emod 60e10 kratio 1.5 bond gap 0.0",
      "execution_order": "Methods execute in the order specified from left to right"
    },
    "conditional_execution": {
      "description": "Use Python for conditional method execution based on contact state",
      "example": [
        "# Bond only contacts with small gap",
        "for c in it.contact.list():",
        "    if c.gap() < 1e-6:",
        "        c.method('bond', {'gap': 0.0})"
      ]
    }
  }
}
