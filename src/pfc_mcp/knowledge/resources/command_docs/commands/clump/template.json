{
  "command": "clump template",
  "category": "clump",
  "search_keywords": [
    "template",
    "define",
    "bubblepack"
  ],
  "description": "Operate on a single clump template. A clump template is a reduced version of a clump composed of pebbles. Additionally, a clump template may hold a surface description that can be used for the calculation of inertial parameters and clump visualization. Clump templates can be created, deleted, imported, and exported. Clump templates are not model components; instead, they may be used to create clumps using the clump replicate, clump generate, or clump distribute commands. Clumps that refer to clump templates may be visualized via their surface descriptions.",
  "syntax": "clump template <keyword> ...",
  "keywords": [
    {
      "name": "create",
      "syntax": "create <keyword> ...",
      "description": "Create a clump template. The inertial attributes must be specified upon creation. One can either specify them directly (volume, inertia, position) or specify their calculation from the pebble distribution (calculate-pebbles) or from the surface description (calculate-surface). The pebbles may be specified directly or automatically via the Bubble Pack algorithm. The clump and all pebbles are translated so that the clump centroid coincides with the origin. IMPORTANT: Clump templates are assumed to have unit density, and the inertia must reflect this condition.",
      "sub_keywords": [
        {
          "name": "name",
          "syntax": "name <s>",
          "description": "Given name of the clump template. If no name specified and no geometry set specified, then name clumpTemplateXX is assigned (XX = template ID). If no name specified but geometry set specified, then s is the geometry set name"
        },
        {
          "name": "pebbles",
          "syntax": "pebbles <inumber> <frad> <vpos> ...",
          "description": "Number of pebbles (inumber), followed by inumber sets of pebble geometric parameters. Each set: pebble radius (frad) and position (fposx, fposy, fposz). Cannot be given with bubblepack keyword"
        },
        {
          "name": "calculate-pebbles",
          "syntax": "calculate-pebbles <ftol>",
          "description": "Calculate clump position, volume, and inertia tensor from pebble distribution assuming constant density. Recursive subdivision algorithm with tolerance ftol (default: 0.01, min: 0.00005). Stops when: 1) total cells reach 1e6 or 2) extrapolated/estimated sizes within tolerance. Cannot be given with inertia, position, calculate-surface, volume, x/y/z keywords"
        },
        {
          "name": "calculate-surface",
          "syntax": "calculate-surface",
          "description": "Calculate inertial attributes from surface description assuming uniform density. Loops through all facets, computes covariance of triangle (2D) or tetrahedron (3D) formed by facet vertices and origin. Cannot be given with inertia, calculate-pebbles, position, volume, x/y/z keywords"
        },
        {
          "name": "bubblepack",
          "syntax": "bubblepack <keyword> ...",
          "description": "Create clump template pebbles via Bubble Pack algorithm (Taghavi 2011). Requires geometry keyword (linear faceted in 2D; triangulated surface in 3D). Surface mesh refined to optimal facet size, medial axis calculated as set of circles (2D) or spheres (3D) nearly tangent with surface. Cannot be given with pebbles keyword",
          "sub_keywords": [
            {
              "name": "distance",
              "syntax": "distance <fdistance>",
              "description": "Angular measure of smoothness in degrees (0 < fdistance < 180). Greater fdistance = smoother pebble distribution. fdistance=0: spheres just touch (no overlap); fdistance=180: spheres just touch with one contained (complete overlap)"
            },
            {
              "name": "ratio",
              "syntax": "ratio <fratio>",
              "description": "Ratio of smallest to largest pebble kept in clump template (0 < fratio < 1)"
            },
            {
              "name": "radfactor",
              "syntax": "radfactor <frad>",
              "description": "Radius factor for pebble consideration. Prospective pebbles: closest distance from center to surface > radius/frad (frad > 1.0, default: 1.05). Smaller factors = less pebble overlap with surface"
            },
            {
              "name": "refinenum",
              "syntax": "refinenum <i>",
              "description": "Maximum number of linear (2D) or triangular (3D) facets for automatic surface mesh refinement. Default: 5,000 (2D) or 10,000 (3D). Increase if pebbles not sufficiently dense. WARNING: Large refinement levels require significant computational time"
            }
          ]
        },
        {
          "name": "geometry",
          "syntax": "geometry <s>",
          "description": "Name of geometry set to be used as surface descriptor. Must be closed, orientable, and manifold surface composed of line segments (2D) or triangular facets (3D)"
        },
        {
          "name": "from-clump",
          "syntax": "from-clump <i> <delete b>",
          "description": "Create template from clump with ID i. Optional delete keyword: if b=true, clump is deleted after template creation. Default: clump retained"
        },
        {
          "name": "volume",
          "syntax": "volume <fvol>",
          "description": "Set volume per unit thickness (2D) or volume (3D) to fvol. Must also specify inertia tensor. Cannot be given with calculate-pebbles or calculate-surface keywords"
        },
        {
          "name": "inertia",
          "syntax": "inertia <fe11> <fe22> <fe33> <fe12> <fe13> <fe23>",
          "description": "Set inertia tensor. 2D: 1 float (polar moment of inertia). 3D: 6 parameters (e11,e22,e33,e12,e13,e23) using row/column convention. Must also specify volume. Cannot be given with calculate-pebbles or calculate-surface keywords"
        },
        {
          "name": "position",
          "syntax": "position <vcpos>",
          "description": "Clump centroid position. Default: origin. Cannot be given with calculate-pebbles or calculate-surface keywords"
        },
        {
          "name": "position-x/y/z",
          "syntax": "position-x <fposx>",
          "description": "Component of position. Default: 0. Cannot be given with calculate-pebbles or calculate-surface keywords"
        }
      ]
    },
    {
      "name": "delete",
      "syntax": "delete <name s>",
      "description": "Delete clump template(s). If name not specified, all clump templates are deleted. Any clumps referring to deleted template(s) no longer refer to any clump template",
      "sub_keywords": [
        {
          "name": "name",
          "syntax": "name <s>",
          "description": "Name of clump template to delete"
        }
      ]
    },
    {
      "name": "export",
      "syntax": "export <s> <keyword> ...",
      "description": "Export clump template s to binary file. Default filename: 'clump.p2clp' (2D) or 'clump.p3clp' (3D). Binary file can be reloaded with import keyword",
      "sub_keywords": [
        {
          "name": "filename",
          "syntax": "filename <s>",
          "description": "Clump template filename. Default: template name appended with .p2clp (2D) or .p3clp (3D)"
        },
        {
          "name": "skip-errors",
          "syntax": "skip-errors",
          "description": "If previous file of specified name exists, it will be overwritten (no error thrown)"
        }
      ]
    },
    {
      "name": "import",
      "syntax": "import <s> <keyword> ...",
      "description": "Import clump template from file with name s. If name not specified, clump name set to filename without extension. Error thrown if template with specified name exists",
      "sub_keywords": [
        {
          "name": "name",
          "syntax": "name <s>",
          "description": "Clump template name. If not specified, clump name set to filename s without file extension"
        }
      ]
    }
  ],
  "notes": [
    "Clump templates are NOT model components - they are used to create clumps via replicate/generate/distribute commands",
    "Clump templates are assumed to have unit density - inertia must reflect this",
    "Templates can hold surface descriptions for inertial calculation and visualization",
    "Clump and pebbles are translated so centroid coincides with origin; original position retained for replication",
    "Bubble Pack algorithm: Taghavi (2011) - automatic pebble generation from surface mesh",
    "Three ways to specify inertial attributes: 1) direct (volume+inertia+position), 2) calculate from pebbles, 3) calculate from surface"
  ],
  "examples": [
    {
      "command": "clump template create name 'three_peb' calculate-pebbles pebbles 3 0.25 (-0.55,0.0,0.6) 0.25 (-0.75,0.0,0.15) 0.25 (-0.75,0.0,0.4)",
      "description": "Create template with 3 pebbles, calculate inertial attributes from pebble distribution (1% tolerance)"
    },
    {
      "command": "clump template create name 'rock' geometry 'rock_surface' calculate-surface",
      "description": "Create template from geometry set 'rock_surface', calculate inertial attributes from surface"
    },
    {
      "command": "clump template create name 'bubble_rock' geometry 'rock_geom' bubblepack distance 45 ratio 0.3 radfactor 1.1",
      "description": "Create template using Bubble Pack algorithm with custom parameters (smoothness=45Â°, size ratio=0.3)"
    },
    {
      "command": "clump template create from-clump 100 name 'from_clump100' delete true",
      "description": "Create template from clump ID 100, delete clump after template creation"
    },
    {
      "command": "clump template delete name 'old_template'",
      "description": "Delete template named 'old_template'"
    },
    {
      "command": "clump template export 'rock' filename 'rock_template.p3clp' skip-errors",
      "description": "Export template 'rock' to file, overwrite if exists"
    },
    {
      "command": "clump template import 'rock_template.p3clp' name 'imported_rock'",
      "description": "Import template from file, name it 'imported_rock'"
    }
  ],
  "python_sdk_alternative": {
    "available": false,
    "workaround": "itasca.command('clump template ...') - Python SDK does not provide direct clump template management"
  }
}
